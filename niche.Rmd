---
title: "Scraping_Airline_Data_Outline"
author: "Augustus Ge"
date: "November 7, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# We are hoping to help Brown University students who are looking to go on a winter vacation but cannot decide where to go. This will scrape flight options data to 10 popular vacation destinations and allow the user to view all relevant options with variables destination, price, duration, stops, rating, arline, airline company reviews (Tripadvisor), departure time, and arrival time.

# Initial query for flight 



Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

```{r}

get_names=function(a){
  names=vector(length=0,mode="character")
  for(i in 1:a){
    url=str_c("https://www.niche.com/colleges/search/best-colleges/?page=",i)
     webpages <- read_html(url)
     name_data <- html_text(html_nodes(webpages, ".search-result__title" ))  
     name_data <- as.vector(name_data)
     names=c(names, name_data)
  }
  names=str_replace_all(names," ","-")
  return(names)
}
get_names(4)

```

```{r}
url<-"https://www.niche.com/colleges/stanford-university/"
webpage1 <- read_html(url)


name_data <- html_text(html_nodes(webpage1, ".postcard__title" ))
ACT_data <- html_text(html_nodes(webpage1, "#admissions .scalar--three:nth-child(2) .scalar__value span" ))

url_review <- str_c(url,"/reviews/")
webpage2<- read_html(url_review)
review_data <- html_text(html_nodes(webpage2, ".overflow-text__content div" ))
review_data

```


```{r}


get_data <- function(name){
  url1 <-"https://www.niche.com/colleges"
  url2 <- str_c(url1,"/",name,"/")
  webpages <- read_html(url2)
  name_data <- html_text(html_nodes(webpages, ".postcard__title" ))  
  ACT_data <- html_text(html_nodes(webpages, "#admissions .scalar--three:nth-child(2) .scalar__value span" ))
  if(length(ACT_data) == 0) ACT_data <- NA
  SAT_data <- html_text(html_nodes(webpages, css = "#admissions > div.profile__buckets > div.profile__bucket--3 > div > div > div:nth-child(1) > div.scalar__value > span"))
  if(length(SAT_data) == 0) SAT_data <- NA
  app_fee <- html_text(html_nodes(webpages, css = "#admissions > div.profile__buckets > div.profile__bucket--3 > div > div > div:nth-child(3) > div.scalar__value > span"))
  if(length(app_fee) == 0) app_fee <- NA
  ACT_SAT_req <- html_text(html_nodes(webpages, css = "#admissions > div.profile__buckets > div.profile__bucket--3 > div > div > div:nth-child(4) > div.scalar__value > span"))
  if(length(ACT_SAT_req) == 0) ACT_SAT_req <- NA
  ed_ea <- html_text(html_nodes(webpages, css = "#admissions > div.profile__buckets > div.profile__bucket--3 > div > div > div:nth-child(6) > div.scalar__value > span"))
  if(length(ed_ea) == 0) ed_ea <- NA
  app_deadline <- html_text(html_nodes(webpages, css = "#admissions > div.profile__buckets > div.profile__bucket--2 > div > div > div > div.scalar__value > span"))
  if(length(app_deadline) == 0) app_deadline <- NA
  undergrad_pop <- html_text(html_nodes(webpages, css = "#students > div.profile__buckets > div.profile__bucket--1 > div > div > div.scalar > div.scalar__value > span:nth-child(1)"))
  if(length(undergrad_pop) == 0) undergrad_pop <- NA
    acceptance_data <- html_text(html_nodes(webpages, "#admissions .profile__bucket--1 .scalar__value span" ))
    if(length(acceptance_data) == 0) acceptance_data <- NA
  annualtuition_data <- html_text(html_nodes(webpages, "#cost .scalar__value span:nth-child(1)" ))
    if(length(annualtuition_data) == 0) annualtuition_data <- NA
  link_data <-  html_text(html_nodes(webpages, ".profile__website__link" ))
    if(length(link_data) == 0) link_data <- NA
  SFRatio_data <- html_text(html_nodes(webpages, ".profile-grade+ .scalar--three .scalar__value span" ))
    if(length(SFRatio_data) == 0) SFRatio_data <- NA
  Eve_data <- html_text(html_nodes(webpages, "#academics .scalar--three+ .scalar--three .scalar__value span" ))
  
  url_review <- str_c(url2,"/reviews/")
  webpage2<- read_html(url_review)
  review_data <- html_text(html_nodes(webpage2, ".overflow-text__content div" ))
  
  url_review <- str_c(url2,"/reviews/")
  webpage2<- read_html(url_review)
  review_data <- html_text(html_nodes(webpage2, ".overflow-text__content div" ))
  # print(name_data)
  # print(ACT_data)
  # print(SAT_data)
  # print(ACT_SAT_req)
  # print(ed_ea)
  # print(app_fee)
  # print(app_deadline)
  # print(undergrad_pop)
  # print(acceptance_data)
  # print(annualtuition_data)
  # print(link_data)
  # print(SFRatio_data)
  # print(Eve_data)
  # print(review_data)
  
  return(c(name_data, ACT_data, SAT_data, ACT_SAT_req, ed_ea, app_fee, app_deadline, undergrad_pop, acceptance_data, annualtuition_data, link_data[1], SFRatio_data, Eve_data))
}

```

```{r}
get_data("brown-university") 

```

```{r}
name_data<-c()

url1 <-"https://www.niche.com/colleges"
  url2 <- str_c(url1,"/","brandeis-university","/")
  webpages <- read_html(url2)
  name_data1 <- html_text(html_nodes(webpages, ".postcard__title" ))  
  
  url3 <- str_c(url1,"/","brown-university","/")
  webpages1 <- read_html(url3)
  name_data2 <- html_text(html_nodes(webpages1, ".postcard__title" ))  
  
```

```{r}
# Initialize data frame
df <- data.frame(matrix(nrow = 100, ncol = 13))
# name_data, ACT_data, SAT_data, ACT_SAT_req, ed_ea, app_fee, app_deadline, undergrad_pop, acceptance_data, annualtuition_data, link_data[1], SFRatio_data, Eve_data
colnames(df) <- c("School", "ACT Middle 50%", "SAT Middle 50%",	"ACT/SAT Required",	"ED/EA", "Application Fee", "Application Deadline", "Undergraduate Population", "Acceptance Rate", "Annual Tuition", "Application Website", "Student:Faculty Ratio", "Evening Degree Programs")

for(i in 1:length(get_names(4))){
  df[i,] <- (get_data(get_names(4)[i]))
}

```


